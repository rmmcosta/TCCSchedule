<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <a href="#">About</a>
  <a href="#">Services</a>
  <a href="#">Clients</a>
  <a href="#">Contact</a>
</div>

<!-- Use any element to open the sidenav -->
<div class="sidenav-open">
  <span onclick="openNav()"><i class="fas fa-angle-double-left"></i></span>
</div>

<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
  <div class="alert alert-success alert-dismissible fade" role="alert">
      Mudança atualizada com <strong>sucesso</strong>!
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
      </button>
  </div>
  <div class="alert alert-danger alert-dismissible fade" role="alert">
      Ocorreu um erro na atualização da mudança!
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
      </button>
  </div>
  <div id='calendar-container' class="mb-5">
      <div id='calendar'></div>
  </div>
</div> 

<style>
  .btn-group {
    width:auto;
  }
  .btn-group>.btn {
    width:auto;
  }
</style>
<script>
    /* Set the width of the side navigation to 250px and the left margin of the page content to 250px */
    function openNav() {
      document.getElementById("mySidenav").style.width = "20%";
      $("#calendar").addClass('calendar-short');
    }
    
    /* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      $("#calendar").removeClass('calendar-short');
    }
  function updateEventOnDB(info) {
    var startDate = moment(info.event.start).tz('Europe/Lisbon').format('YYYY-MM-DD HH:mm:ss');
    var endDate = moment(info.event.end).tz('Europe/Lisbon').format('YYYY-MM-DD HH:mm:ss');
    var id = info.event.id;
    jQuery.ajax({
      type: "POST",
      url: 'schedulesCalendarEventUpdate.php',
      dataType: 'json',
      data: {functionname: 'updateEvent', arguments: [startDate,endDate,id]},

      success: function (obj, textstatus) {
                    if( !('error' in obj) ) {
                        console.log(obj.result);
                        $('.alert-success').addClass('show');
                    }
                    else {
                        console.log(obj.error);
                        $('.alert-danger').addClass('show');
                    }
              }
    });
  }

  function updateEventEndOnDB(info) {
    var endDate = moment(info.event.end).tz('Europe/Lisbon').format('YYYY-MM-DD HH:mm:ss');
    var id = info.event.id;
    jQuery.ajax({
      type: "POST",
      url: 'schedulesCalendarEventUpdate.php',
      dataType: 'json',
      data: {functionname: 'updateEventEnd', arguments: [endDate,id]},

      success: function (obj, textstatus) {
                    if( !('error' in obj) ) {
                        console.log(obj.result);
                        $('.alert-success').addClass('show');
                    }
                    else {
                        console.log(obj.error);
                        $('.alert-danger').addClass('show');
                    }
              },
      error: function(jqXHR, textStatus, errorThrown ) {
        console.log(jqXHR);
        console.log(textStatus);
        console.log(errorThrown);
      },
      complete: function() {
        console.log('ajax finished');
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    function getEvents() {
        return [
          <?php echo getSchedulesCalendar($db);?>
      ];
    }
    var calendarEl = document.getElementById('calendar');
    var scrollTime = moment().format("HH:mm:ss");
    var calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: [ 'interaction', 'dayGrid', 'timeGrid', 'list', 'bootstrap' ],
      themeSystem: 'bootstrap',
      views: {
        dayGridMonth: {
          eventLimit: 10 // adjust to 6 only for timeGridWeek/timeGridDay
        }
      },
      height: 'parent',
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,dayGridWeek,dayGridDay,listWeek'
      },
      displayEventTime:true,
      displayEventEnd:true,
      eventAllow: function(){
        return true;
      }, // to be reviewed. we should have a function to validate this
      locale:'pt',
      defaultView: 'dayGridDay',
      firstDay: (new Date().getDay())-1,
      scrollTime: scrollTime,
      nowIndicator: true,
      defaultDate: new Date(),
      navLinks: true, // can click day/week names to navigate views
      editable: true,
      eventLimit: true, // allow "more" link when too many events,
      eventOverlap: true,
      selectMirror: true,
      selectable: true,
      displayEventTime: false,
      eventResize: updateEventEndOnDB,
      eventDrop: updateEventOnDB,
      eventRender: function(info) {
        var tooltip = new Tooltip(info.el, {
          title: info.event.extendedProps.description,
          placement: 'top',
          trigger: 'hover',
          container: 'body'
        });
      },
      events: getEvents()
    });

    calendar.render();
  });

</script>